# WebAuthn Fingerprint Test

–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ—Ç–ø–µ—á–∞—Ç–∫–∏ –ø–∞–ª—å—Ü–µ–≤, Face ID) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º WebAuthn API.

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è WebAuthn –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –±–µ–∑ –ª–æ–≥–∏–Ω–æ–≤ –∏ –ø–∞—Ä–æ–ª–µ–π.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–¢–æ–ª—å–∫–æ –±–∏–æ–º–µ—Ç—Ä–∏—è** - –±–µ–∑ –ª–æ–≥–∏–Ω–æ–≤, –ø–∞—Ä–æ–ª–µ–π, email
- ‚úÖ **–¢–æ–ª—å–∫–æ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–µ—Å–∫—Ç–æ–ø–æ–≤
- ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –º–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** - –ª–µ–≥–∫–∏–π –∑–∞–ø—É—Å–∫
- ‚úÖ **jQuery + PHP** - –ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥
- ‚úÖ **HTTPS —á–µ—Ä–µ–∑ tuna** - –≥–æ—Ç–æ–≤–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
/root/otpechatokv2/
‚îú‚îÄ‚îÄ docker/                    # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ apache/000-default.conf   # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Apache
‚îÇ   ‚îî‚îÄ‚îÄ mysql/init.sql            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îú‚îÄ‚îÄ public/                    # –í–µ–±-—Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.php                 # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
‚îÇ   ‚îú‚îÄ‚îÄ webauthn.html            # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ WebAuthn
‚îÇ   ‚îú‚îÄ‚îÄ api.php                  # REST API backend
‚îÇ   ‚îî‚îÄ‚îÄ styles.css               # –°—Ç–∏–ª–∏
‚îú‚îÄ‚îÄ src/                      # PHP –∫–ª–∞—Å—Å—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ Database.php             # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ DeviceDetector.php       # –î–µ—Ç–µ–∫—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îú‚îÄ‚îÄ Dockerfile                # –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ docker-compose.yml        # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ composer.json             # PHP –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
cd /root/otpechatokv2
docker-compose up -d
```

### 2. –ó–∞–ø—É—Å–∫ HTTPS —Ç—É–Ω–Ω–µ–ª—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ tuna (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
winget install --id yuccastream.tuna

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
tuna config save-token tt_4wd704pwo95pi0xdmapgods58fvgwvxs

# –ó–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—è
tuna http 8080
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É tuna –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ**
2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å** —á–µ—Ä–µ–∑ –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –ø–∞–ª—å—Ü–∞
3. **–í–æ–π–¥–∏—Ç–µ** —á–µ—Ä–µ–∑ –±–∏–æ–º–µ—Ç—Ä–∏—é

## üì± –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

- **iOS**: iPhone/iPad —Å Touch ID –∏–ª–∏ Face ID
- **Android**: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å –æ—Ç–ø–µ—á–∞—Ç–∫–æ–º –ø–∞–ª—å—Ü–∞ (Android 6.0+)

## üõ†Ô∏è API Endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/api.php?action=device-info` | GET | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ |
| `/api.php?action=register-options` | POST | –û–ø—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ WebAuthn |
| `/api.php?action=register-verify` | POST | –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| `/api.php?action=auth-options` | POST | –û–ø—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `/api.php?action=auth-verify` | POST | –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `/api.php?action=logout` | POST | –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã |
| `/api.php?action=status` | GET | –°—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã MySQL:

- **`users`** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (ID + handle)
- **`user_credentials`** - WebAuthn —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **`user_sessions`** - –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

- **Host**: `db` (–≤–Ω—É—Ç—Ä–∏ Docker)
- **Database**: `webauthn_db`
- **User**: `webauthn_user`
- **Password**: `webauthn_pass`

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f web

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose restart web

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
docker-compose exec db mysql -u webauthn_user -p webauthn_db

# –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
docker-compose down -v
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ WebAuthn –ø–æ–¥–¥–µ—Ä–∂–∫–∏:

```javascript
console.log('WebAuthn support:', !!window.PublicKeyCredential);
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **"Device not supported"** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
2. **"Challenge mismatch"** - –ø—Ä–æ–±–ª–µ–º–∞ —Å base64url –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
3. **"Credential not found"** - –ø–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å

### –õ–æ–≥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools ‚Üí Console –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç!

**–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
- –ü–æ–ª–Ω–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è WebAuthn
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CBOR/COSE –¥–∞–Ω–Ω—ã—Ö
- –í–∞–ª–∏–¥–Ω—ã–µ HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF/XSS –∞—Ç–∞–∫

## üì¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Frontend**: HTML5, jQuery 3.7.1, CSS3
- **Backend**: PHP 8.2, MySQL 8.0
- **WebAuthn**: –ù–∞—Ç–∏–≤–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π API
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker, Docker Compose
- **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**: Apache 2.4
- **–¢—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: Tuna –¥–ª—è HTTPS

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `docker-compose up -d` –∏ `tuna http 8080`, –∑–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.